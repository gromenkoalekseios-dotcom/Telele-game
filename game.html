<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>‚ö° POWER CLICKER</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #050510;
    --accent: #00ffcc;
    --accent2: #ff00aa;
    --accent3: #ffee00;
  }
  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
  html,body { width:100%; height:100%; overflow:hidden; background:var(--bg); font-family:'Share Tech Mono',monospace; color:var(--accent); }

  body::before {
    content:''; position:fixed; inset:0;
    background-image: linear-gradient(rgba(0,255,204,0.03) 1px,transparent 1px), linear-gradient(90deg,rgba(0,255,204,0.03) 1px,transparent 1px);
    background-size:30px 30px; pointer-events:none; z-index:0;
  }

  .app { display:flex; flex-direction:column; height:100vh; height:100dvh; position:relative; z-index:1; }

  .header { display:flex; align-items:center; justify-content:space-between; padding:8px 14px 4px; flex-shrink:0; }
  .logo { font-family:'Orbitron',monospace; font-size:1rem; font-weight:900; letter-spacing:0.2em; color:var(--accent); text-shadow:0 0 15px #00ffcc88; }
  .save-dot { width:7px; height:7px; border-radius:50%; background:#00ffcc22; transition:background 0.4s,box-shadow 0.4s; }
  .save-dot.saving { background:var(--accent3); box-shadow:0 0 8px var(--accent3); }
  .save-dot.saved  { background:var(--accent);  box-shadow:0 0 8px var(--accent); }
  .save-dot.error  { background:var(--accent2); box-shadow:0 0 8px var(--accent2); }

  .center { display:flex; flex-direction:column; align-items:center; justify-content:center; flex-shrink:0; padding:6px 0 10px; gap:5px; }
  .score-label { font-size:0.52rem; letter-spacing:0.3em; color:#00ffcc33; }
  .score { font-family:'Orbitron',monospace; font-size:2.4rem; font-weight:900; color:var(--accent); text-shadow:0 0 25px #00ffcc99; line-height:1; transition:transform 0.05s; }
  .score.bump { transform:scale(1.06); }
  .per-sec { font-size:0.62rem; color:var(--accent2); text-shadow:0 0 8px var(--accent2); letter-spacing:0.1em; }

  .click-btn {
    width:130px; height:130px; border-radius:50%;
    border:2px solid var(--accent);
    background:radial-gradient(circle at 40% 35%,#001a14,#000508);
    cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:3.2rem;
    box-shadow:0 0 25px #00ffcc44,inset 0 0 25px #00ffcc0d;
    transition:transform 0.07s,box-shadow 0.07s; user-select:none; position:relative;
  }
  .click-btn::after { content:''; position:absolute; inset:-6px; border-radius:50%; border:1.5px solid var(--accent); opacity:0; animation:ring 3s ease-in-out infinite; }
  @keyframes ring { 0%,100%{opacity:0;transform:scale(1)} 50%{opacity:0.2;transform:scale(1.05)} }
  .click-btn:active { transform:scale(0.90); box-shadow:0 0 60px #00ffccaa,inset 0 0 30px #00ffcc22; }
  .click-info { font-size:0.56rem; color:#00ffcc33; letter-spacing:0.1em; }

  .tabs { display:flex; border-top:1px solid #00ffcc18; border-bottom:1px solid #00ffcc18; flex-shrink:0; }
  .tab { flex:1; background:none; border:none; color:#00ffcc44; font-family:'Orbitron',monospace; font-size:0.52rem; letter-spacing:0.1em; padding:8px 2px; cursor:pointer; transition:color 0.2s,background 0.2s; text-transform:uppercase; }
  .tab.active { color:var(--accent); background:#00ffcc0a; text-shadow:0 0 8px var(--accent); }

  .panels { flex:1; overflow:hidden; position:relative; }
  .panel { position:absolute; inset:0; overflow-y:auto; padding:8px 10px 16px; display:none; -webkit-overflow-scrolling:touch; }
  .panel.active { display:block; }
  .panel::-webkit-scrollbar { width:3px; }
  .panel::-webkit-scrollbar-thumb { background:#00ffcc22; border-radius:2px; }

  .item-btn {
    width:100%; background:#000; border:1px solid #00ffcc18; color:var(--accent);
    font-family:'Share Tech Mono',monospace; font-size:0.7rem; padding:10px 12px; margin-bottom:6px;
    cursor:pointer; display:flex; justify-content:space-between; align-items:center;
    transition:border-color 0.15s,background 0.15s; text-align:left; border-radius:2px;
  }
  .item-btn:active:not(.locked) { border-color:var(--accent); background:#00ffcc08; }
  .item-btn.locked { opacity:0.25; }
  .item-left { display:flex; flex-direction:column; gap:2px; }
  .item-name { color:var(--accent); font-size:0.7rem; }
  .item-desc { font-size:0.56rem; color:#00ffcc44; }
  .item-owned { font-size:0.54rem; color:var(--accent2); }
  .item-cost { color:var(--accent3); font-size:0.66rem; white-space:nowrap; padding-left:8px; }

  .prestige-wrap { margin-top:8px; }
  .prestige-btn {
    width:100%; background:linear-gradient(135deg,#1a0020,#0a000f);
    border:1px solid var(--accent2); color:var(--accent2); font-family:'Orbitron',monospace;
    font-size:0.58rem; letter-spacing:0.08em; padding:12px 8px; cursor:pointer;
    text-shadow:0 0 10px var(--accent2); box-shadow:0 0 12px #ff00aa18; transition:all 0.2s; border-radius:2px;
  }
  .prestige-btn:active:not([disabled]) { box-shadow:0 0 25px #ff00aa55; }
  .prestige-btn[disabled] { opacity:0.2; cursor:not-allowed; }
  .prestige-info { font-size:0.54rem; color:var(--accent2); text-align:center; margin-top:5px; line-height:1.7; }

  .stat-row { display:flex; justify-content:space-between; padding:9px 0; border-bottom:1px solid #00ffcc0a; font-size:0.66rem; }
  .stat-row:last-child { border-bottom:none; }
  .stat-label { color:#00ffcc44; }
  .stat-val { color:var(--accent); }

  .float-text { position:fixed; font-family:'Orbitron',monospace; font-weight:700; pointer-events:none; z-index:500; animation:floatUp 0.85s ease-out forwards; }
  @keyframes floatUp { 0%{opacity:1;transform:translateY(0) scale(1)} 100%{opacity:0;transform:translateY(-65px) scale(0.5)} }

  .notif { position:fixed; bottom:16px; left:50%; transform:translateX(-50%); background:#0a0a1f; border:1px solid var(--accent3); color:var(--accent3); font-family:'Share Tech Mono',monospace; font-size:0.62rem; padding:7px 16px; z-index:200; animation:notifAnim 2s ease forwards; white-space:nowrap; border-radius:2px; }
  @keyframes notifAnim { 0%{opacity:0;bottom:4px} 15%{opacity:1;bottom:16px} 75%{opacity:1;bottom:16px} 100%{opacity:0;bottom:4px} }

  #loading-screen { position:fixed; inset:0; background:var(--bg); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:1000; gap:14px; }
  .loading-text { font-family:'Orbitron',monospace; font-size:0.7rem; letter-spacing:0.25em; color:var(--accent); animation:blink 1s ease-in-out infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.25} }
</style>
</head>
<body>

<div id="loading-screen">
  <div style="font-size:2.5rem">‚ö°</div>
  <div class="loading-text">–ó–ê–ì–†–£–ó–ö–ê...</div>
</div>

<div class="app">
  <div class="header">
    <div class="logo">‚ö° POWER CLICKER</div>
    <div class="save-dot" id="save-dot"></div>
  </div>

  <div class="center">
    <div class="score-label">–≠–ù–ï–†–ì–ò–Ø</div>
    <div class="score" id="score">0</div>
    <div class="per-sec" id="per-sec">+0 / —Å–µ–∫</div>
    <button class="click-btn" id="click-btn" onclick="handleClick(event)">‚ö°</button>
    <div class="click-info" id="click-info">–∑–∞ –∫–ª–∏–∫: +1</div>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('upgrades',this)">‚ñ∏ –£–õ–£–ß–®–ï–ù–ò–Ø</button>
    <button class="tab" onclick="switchTab('generators',this)">‚óà –ì–ï–ù–ï–†–ê–¢–û–†–´</button>
    <button class="tab" onclick="switchTab('stats',this)">‚â° –°–¢–ê–¢–ò–°–¢–ò–ö–ê</button>
  </div>

  <div class="panels">
    <div class="panel active" id="panel-upgrades"><div id="upgrades-list"></div></div>
    <div class="panel" id="panel-generators">
      <div id="auto-list"></div>
      <div class="prestige-wrap">
        <button class="prestige-btn" id="prestige-btn" onclick="doPrestige()">‚óà PRESTIGE</button>
        <div class="prestige-info" id="prestige-info"></div>
      </div>
    </div>
    <div class="panel" id="panel-stats"><div id="stats-list"></div></div>
  </div>
</div>

<script>
const tg = window.Telegram?.WebApp;
if (tg) { tg.expand(); tg.disableVerticalSwipes?.(); }

const useCloud = !!(tg && tg.CloudStorage);
const SAVE_KEY = 'pclick_v3';

// ‚îÄ‚îÄ –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const BASE_UPGRADES = [
  { name:'–£—Å–∏–ª–∏—Ç–µ–ª—å',   desc:'+1 –∑–∞ –∫–ª–∏–∫',   cost:50,     clickBonus:1   },
  { name:'–°—É–ø–µ—Ä–∑–∞—Ä—è–¥',  desc:'+5 –∑–∞ –∫–ª–∏–∫',   cost:300,    clickBonus:5   },
  { name:'–ú–æ–ª–Ω–∏—è',      desc:'+20 –∑–∞ –∫–ª–∏–∫',  cost:2000,   clickBonus:20  },
  { name:'–ü–ª–∞–∑–º–∞',      desc:'+100 –∑–∞ –∫–ª–∏–∫', cost:15000,  clickBonus:100 },
  { name:'–ê–Ω—Ç–∏–º–∞—Ç–µ—Ä–∏—è', desc:'+500 –∑–∞ –∫–ª–∏–∫', cost:100000, clickBonus:500 },
];
const BASE_GENERATORS = [
  { name:'–ë–∞—Ç–∞—Ä–µ–π–∫–∞',        desc:'+1/—Å–µ–∫',    cost:100,    perSec:1    },
  { name:'–°–æ–ª–Ω–µ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å', desc:'+5/—Å–µ–∫',    cost:500,    perSec:5    },
  { name:'–†–µ–∞–∫—Ç–æ—Ä',          desc:'+25/—Å–µ–∫',   cost:3000,   perSec:25   },
  { name:'–¢–µ—Ä–º–æ—è–¥–µ—Ä–Ω—ã–π',     desc:'+150/—Å–µ–∫',  cost:20000,  perSec:150  },
  { name:'–¢—ë–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è',   desc:'+1000/—Å–µ–∫', cost:150000, perSec:1000 },
];

// –ú–Ω–æ–∂–∏—Ç–µ–ª–∏ —Ä–æ—Å—Ç–∞ —Ü–µ–Ω—ã
const U_MULT = 2.2;
const G_MULT = 1.8;

// –§—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫—É–ø–ª–µ–Ω–Ω—ã—Ö
function calcCost(baseCost, owned, mult) {
  let c = baseCost;
  for (let i = 0; i < owned; i++) c = Math.floor(c * mult);
  return c;
}

// ‚îÄ‚îÄ –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let score         = 0;
let totalClicks   = 0;
let totalEarned   = 0;
let prestigeCount = 0;
let prestigeMulti = 1;

// owned[i] ‚Äî —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –∫—É–ø–ª–µ–Ω –∞–ø–≥—Ä–µ–π–¥/–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
let uOwned = [0, 0, 0, 0, 0];
let gOwned = [0, 0, 0, 0, 0];

// ‚îÄ‚îÄ –ì–µ—Ç—Ç–µ—Ä—ã ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getClickPower() {
  let bonus = 0;
  for (let i = 0; i < BASE_UPGRADES.length; i++)
    bonus += BASE_UPGRADES[i].clickBonus * uOwned[i];
  return Math.max(1, Math.floor((1 + bonus) * prestigeMulti));
}

function getPerSec() {
  let ps = 0;
  for (let i = 0; i < BASE_GENERATORS.length; i++)
    ps += BASE_GENERATORS[i].perSec * gOwned[i];
  return Math.floor(ps * prestigeMulti);
}

function fmt(n) {
  n = Math.floor(n);
  if (n >= 1e9) return (n/1e9).toFixed(2) + 'B';
  if (n >= 1e6) return (n/1e6).toFixed(2) + 'M';
  if (n >= 1e3) return (n/1e3).toFixed(1) + 'K';
  return '' + n;
}

// ‚îÄ‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildSave() {
  return JSON.stringify({
    v: 3,
    score, totalClicks, totalEarned,
    prestigeCount, prestigeMulti,
    uOwned, gOwned
  });
}

function applySave(raw) {
  try {
    const d = JSON.parse(raw);
    score         = Number(d.score)         || 0;
    totalClicks   = Number(d.totalClicks)   || 0;
    totalEarned   = Number(d.totalEarned)   || 0;
    prestigeCount = Number(d.prestigeCount) || 0;
    prestigeMulti = Number(d.prestigeMulti) || 1;
    if (Array.isArray(d.uOwned)) uOwned = d.uOwned.map(x => Number(x)||0);
    if (Array.isArray(d.gOwned)) gOwned = d.gOwned.map(x => Number(x)||0);
  } catch(e) {
    console.log('Save parse error:', e);
  }
}

let saveTimer = null;
function scheduleSave() {
  clearTimeout(saveTimer);
  saveTimer = setTimeout(doSave, 3000);
}

function setDot(cls) {
  const d = document.getElementById('save-dot');
  d.className = 'save-dot ' + cls;
  if (cls) setTimeout(() => d.className = 'save-dot', 2500);
}

function doSave() {
  const data = buildSave();
  setDot('saving');
  if (useCloud) {
    tg.CloudStorage.setItem(SAVE_KEY, data, err => {
      if (err) { try { localStorage.setItem(SAVE_KEY, data); } catch(_){} setDot('error'); }
      else setDot('saved');
    });
  } else {
    try { localStorage.setItem(SAVE_KEY, data); } catch(_){}
    setDot('saved');
  }
}

function loadSave(cb) {
  if (useCloud) {
    tg.CloudStorage.getItem(SAVE_KEY, (err, val) => {
      if (!err && val) applySave(val);
      else { const l = localStorage.getItem(SAVE_KEY); if (l) applySave(l); }
      cb();
    });
  } else {
    const l = localStorage.getItem(SAVE_KEY);
    if (l) applySave(l);
    cb();
  }
}

// ‚îÄ‚îÄ –ò–≥—Ä–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function handleClick(e) {
  const power = getClickPower();
  score       += power;
  totalClicks++;
  totalEarned += power;

  // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–ª–∞
  const el = document.createElement('div');
  el.className = 'float-text';
  el.textContent = '+' + fmt(power);
  el.style.left = (e.clientX - 16) + 'px';
  el.style.top  = (e.clientY - 16) + 'px';
  const col = Math.random() > 0.5 ? '#00ffcc' : '#ffee00';
  el.style.color = col;
  el.style.textShadow = '0 0 8px ' + col;
  el.style.fontSize = Math.min(0.8 + power / 60, 1.8) + 'rem';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 850);

  // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
  const btn = document.getElementById('click-btn');
  btn.style.transform = 'scale(0.90)';
  btn.style.boxShadow = '0 0 60px #00ffccaa,inset 0 0 30px #00ffcc22';
  setTimeout(() => { btn.style.transform = ''; btn.style.boxShadow = ''; }, 80);

  scheduleSave();
  updateUI();
}

function buyUpgrade(idx) {
  const base = BASE_UPGRADES[idx];
  const cost = calcCost(base.cost, uOwned[idx], U_MULT);
  if (score < cost) return;
  score -= cost;
  uOwned[idx]++;
  notify('‚ö° ' + base.name + ' –∫—É–ø–ª–µ–Ω–æ!');
  doSave(); // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ä–∞–∑—É
  updateUI();
}

function buyGenerator(idx) {
  const base = BASE_GENERATORS[idx];
  const cost = calcCost(base.cost, gOwned[idx], G_MULT);
  if (score < cost) return;
  score -= cost;
  gOwned[idx]++;
  notify('‚óà ' + base.name + ' –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
  doSave(); // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ä–∞–∑—É
  updateUI();
}

function doPrestige() {
  const thr = 1e6 * Math.pow(5, prestigeCount);
  if (totalEarned < thr) return;

  prestigeCount++;
  prestigeMulti = 1 + prestigeCount * 0.5;

  // –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å
  score       = 0;
  totalEarned = 0;
  totalClicks = 0;
  uOwned      = [0, 0, 0, 0, 0];
  gOwned      = [0, 0, 0, 0, 0];

  notify('üåü PRESTIGE x' + prestigeCount + '! –ú–Ω–æ–∂–∏—Ç–µ–ª—å x' + prestigeMulti);
  doSave();
  updateUI();
}

function notify(msg) {
  document.querySelector('.notif')?.remove();
  const el = document.createElement('div');
  el.className = 'notif';
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 2000);
}

function switchTab(name, btn) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('panel-' + name).classList.add('active');
}

// ‚îÄ‚îÄ –û—Ç—Ä–∏—Å–æ–≤–∫–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateUI() {
  // –°—á—ë—Ç
  const scoreEl = document.getElementById('score');
  scoreEl.textContent = fmt(score);
  scoreEl.classList.remove('bump');
  void scoreEl.offsetWidth; // reflow –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
  scoreEl.classList.add('bump');
  setTimeout(() => scoreEl.classList.remove('bump'), 60);

  document.getElementById('per-sec').textContent = '+' + fmt(getPerSec()) + ' / —Å–µ–∫';
  document.getElementById('click-info').textContent = '–∑–∞ –∫–ª–∏–∫: +' + fmt(getClickPower());

  // –£–ª—É—á—à–µ–Ω–∏—è
  const ul = document.getElementById('upgrades-list');
  ul.innerHTML = '';
  BASE_UPGRADES.forEach((base, i) => {
    const cost = calcCost(base.cost, uOwned[i], U_MULT);
    const canBuy = score >= cost;
    const btn = document.createElement('button');
    btn.className = 'item-btn' + (canBuy ? '' : ' locked');
    btn.innerHTML =
      '<div class="item-left">' +
        '<span class="item-name">' + base.name + '</span>' +
        '<span class="item-desc">' + base.desc + '</span>' +
        (uOwned[i] > 0 ? '<span class="item-owned">–∫—É–ø–ª–µ–Ω–æ: ' + uOwned[i] + '</span>' : '') +
      '</div>' +
      '<span class="item-cost">' + fmt(cost) + ' ‚ö°</span>';
    btn.addEventListener('click', () => buyUpgrade(i));
    ul.appendChild(btn);
  });

  // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã
  const gl = document.getElementById('auto-list');
  gl.innerHTML = '';
  BASE_GENERATORS.forEach((base, i) => {
    const cost = calcCost(base.cost, gOwned[i], G_MULT);
    const canBuy = score >= cost;
    const btn = document.createElement('button');
    btn.className = 'item-btn' + (canBuy ? '' : ' locked');
    btn.innerHTML =
      '<div class="item-left">' +
        '<span class="item-name">' + base.name + '</span>' +
        '<span class="item-desc">' + base.desc + '</span>' +
        (gOwned[i] > 0 ? '<span class="item-owned">–∞–∫—Ç–∏–≤–Ω–æ: ' + gOwned[i] + '</span>' : '') +
      '</div>' +
      '<span class="item-cost">' + fmt(cost) + ' ‚ö°</span>';
    btn.addEventListener('click', () => buyGenerator(i));
    gl.appendChild(btn);
  });

  // Prestige
  const thr = 1e6 * Math.pow(5, prestigeCount);
  const pb = document.getElementById('prestige-btn');
  if (totalEarned >= thr) pb.removeAttribute('disabled');
  else pb.setAttribute('disabled', '');
  pb.textContent = '‚óà PRESTIGE (–Ω—É–∂–Ω–æ ' + fmt(thr) + ' ‚ö°)';
  document.getElementById('prestige-info').innerHTML = prestigeCount
    ? 'Prestige: ' + prestigeCount + '  ¬∑  –ú–Ω–æ–∂–∏—Ç–µ–ª—å: x' + prestigeMulti + '<br>–ù–∞–∫–æ–ø–ª–µ–Ω–æ: ' + fmt(totalEarned) + ' / ' + fmt(thr)
    : '–ù–∞–∫–æ–ø–∏ ' + fmt(thr) + ' ‚ö° –¥–ª—è Prestige';

  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  document.getElementById('stats-list').innerHTML =
    '<div class="stat-row"><span class="stat-label">–≠–Ω–µ—Ä–≥–∏—è</span><span class="stat-val">' + fmt(score) + ' ‚ö°</span></div>' +
    '<div class="stat-row"><span class="stat-label">–í—Å–µ–≥–æ –Ω–∞–∫–æ–ø–ª–µ–Ω–æ</span><span class="stat-val">' + fmt(totalEarned) + ' ‚ö°</span></div>' +
    '<div class="stat-row"><span class="stat-label">–ö–ª–∏–∫–æ–≤</span><span class="stat-val">' + fmt(totalClicks) + '</span></div>' +
    '<div class="stat-row"><span class="stat-label">–ó–∞ –∫–ª–∏–∫</span><span class="stat-val">+' + fmt(getClickPower()) + ' ‚ö°</span></div>' +
    '<div class="stat-row"><span class="stat-label">–í —Å–µ–∫—É–Ω–¥—É</span><span class="stat-val">+' + fmt(getPerSec()) + ' ‚ö°</span></div>' +
    '<div class="stat-row"><span class="stat-label">Prestige</span><span class="stat-val">' + prestigeCount + 'x</span></div>' +
    '<div class="stat-row"><span class="stat-label">–ú–Ω–æ–∂–∏—Ç–µ–ª—å</span><span class="stat-val">x' + prestigeMulti + '</span></div>' +
    '<div class="stat-row"><span class="stat-label">–û–±–ª–∞–∫–æ</span><span class="stat-val">' + (useCloud ? '‚úì Telegram' : 'localStorage') + '</span></div>';
}

// ‚îÄ‚îÄ –ê–≤—Ç–æ—Ç–∏–∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
setInterval(() => {
  const ps = getPerSec();
  if (ps > 0) {
    const gain = ps / 20;
    score       += gain;
    totalEarned += gain;
    updateUI();
  }
}, 50);

// –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
setInterval(doSave, 10000);

// –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è
window.addEventListener('beforeunload', doSave);
window.addEventListener('pagehide', doSave);
window.addEventListener('blur', doSave);

// Page Visibility ‚Äî –≥–ª–∞–≤–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤ Telegram
document.addEventListener('visibilitychange', () => {
  if (document.visibilityState === 'hidden') doSave();
});

// Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
if (tg) {
  tg.onEvent('viewportChanged', doSave);
}

// ‚îÄ‚îÄ –°—Ç–∞—Ä—Ç ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
loadSave(() => {
  document.getElementById('loading-screen').style.display = 'none';
  updateUI();
});
</script>
</body>
</html>
